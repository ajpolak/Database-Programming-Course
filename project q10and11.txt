--Question 10
CREATE OR REPLACE PROCEDURE RECEIPT(p_CLIENTID in CLIENT.CLIENTID%TYPE,
p_CLIENTORDER IN CLIENTORDER.ORDERDATE%TYPE,
client_Firstname out client.firstname%type,
client_Lastname out client.lastname%type,
book_title out book.booktitle%type,
book_price out book.price%type,
book_id out clientorder.bookid%type,
return_date out clientorder.requiredate%type) AS
BEGIN
select client.firstname, client.lastname
into client_firstname, client_lastname
from client where clientid = p_clientid;

select book.booktitle, book.price, clientorder.bookid, clientorder.requiredate
into book_title, book_price, book_id, return_date
from clientorder inner join book on clientorder.bookid = book.bookid
where clientorder.orderdate = p_clientorder;
dbms_output.put_line('      RECEIPT');
dbms_output.put_line('Date: ' || p_clientorder);
dbms_output.put_line('Name: ' || client_firstname || ' ' || client_lastname);
dbms_output.put_line('Book ID: ' || book_id);
dbms_output.put_line('Book Title: ' || book_title);
dbms_output.put_line('Book price:  $' || book_price);
dbms_output.put_line('Return date: ' || return_date);
end;

declare 
idclient varchar2(5) := '2011';
order_date date := '12-Mar-11';
clientFNAME client.firstname%type;
clientLNAME client.lastname%type;
book__TITLE book.booktitle%type;
bookPRICE book.price%type;
idbook clientorder.bookid%type;
returndate clientorder.requiredate%type;
begin
receipt(idclient, order_date, clientFNAME, clientLNAME, book__title, bookprice, idbook, returndate);
end;

--QUESTION 11
CREATE OR REPLACE PROCEDURE CHECKAVAILABILITY(p_booktitle in book.booktitle%TYPE) as
begin
if(checkrent(p_booktitle) = ('OutofStock')) 
then
dbms_output.put_line(getReturndate(getBookid(p_booktitle)));
else 
dbms_output.put_line('The book is Instock');
end if;
end;

CREATE OR REPLACE FUNCTION getReturndate(p_bookid in clientorder.bookid%type)
return clientorder.requiredate%type is returndate clientorder.requiredate%type;
begin
select clientorder.requiredate into returndate from clientorder where clientorder.bookid = p_bookid;
return returndate;
end getReturndate;

CREATE OR REPLACE FUNCTION getBOOKID(p_booktitle in book.booktitle%type)
return book.bookid%type is book_id book.bookid%type;
begin
select book.bookid into book_id from book where book.booktitle = p_booktitle;
return book_id;
end getBOOKID;


select getReturndate('1004') from dual;
select CHECKAVAILABILITY('Animal Farm') from dual;
select (getReturndate(getBookid('Animal Farm'))) from dual;
select checkrent('1984') from dual;

declare
book_title varchar2(50) := '1984';
begin
checkavailability(book_title);
end;